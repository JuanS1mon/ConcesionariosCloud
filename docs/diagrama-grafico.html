<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrama de Flujo Completo - Sistema de CotizaciÃ³n de Autos</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }
        .diagram-container {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .info-box {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .export-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .legend-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            text-align: center;
        }
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
        }
        .cliente { background-color: #3498db; }
        .sistema { background-color: #2ecc71; }
        .decision { background-color: #e74c3c; }
        .proceso { background-color: #f39c12; }
        .base-datos { background-color: #9b59b6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš— Diagrama de Flujo Completo: Sistema de CotizaciÃ³n de Autos</h1>

        <div class="info-box">
            <h3>ğŸ“‹ InformaciÃ³n del Diagrama</h3>
            <p>Este diagrama muestra el flujo completo desde que un cliente solicita una cotizaciÃ³n hasta la entrega final del vehÃ­culo, incluyendo todos los mÃ³dulos del sistema de pricing inteligente.</p>
        </div>

        <div class="legend">
            <div class="legend-item">
                <span class="legend-color cliente"></span>
                <strong>Cliente</strong><br>Acciones del cliente
            </div>
            <div class="legend-item">
                <span class="legend-color sistema"></span>
                <strong>Sistema</strong><br>Procesos automÃ¡ticos
            </div>
            <div class="legend-item">
                <span class="legend-color decision"></span>
                <strong>Decisiones</strong><br>Puntos de bifurcaciÃ³n
            </div>
            <div class="legend-item">
                <span class="legend-color proceso"></span>
                <strong>Procesos</strong><br>Acciones manuales
            </div>
            <div class="legend-item">
                <span class="legend-color base-datos"></span>
                <strong>Base de Datos</strong><br>Almacenamiento
            </div>
        </div>

        <div class="diagram-container">
            <div class="mermaid">
flowchart TD
    %% Clientes y Canales de Entrada
    A[ğŸ‘¤ Cliente] --> B{ğŸ“ Â¿CÃ³mo contacta?}
    B -->|ğŸŒ Sitio Web| C[ğŸ“ Formulario Web]
    B -->|ğŸ’¬ WhatsApp| D[ğŸ’¬ Chat WhatsApp]
    B -->|ğŸ“ Llamada| E[ğŸ“ AtenciÃ³n TelefÃ³nica]
    B -->|ğŸ¢ Presencial| F[ğŸ¢ Showroom]

    %% RecepciÃ³n de Consulta
    C --> G[ğŸ“¨ RecepciÃ³n de Consulta]
    D --> G
    E --> G
    F --> G

    G --> H{ğŸ” Â¿Auto especÃ­fico?}
    H -->|âœ… SÃ­| I[ğŸ” Buscar Auto en Inventario]
    H -->|âŒ No| J[ğŸ“‹ Mostrar CatÃ¡logo/General]

    %% BÃºsqueda y Pricing
    I --> K{ğŸ“Š Â¿Auto encontrado?}
    K -->|âœ… SÃ­| L[ğŸ“„ Obtener Datos del Auto]
    K -->|âŒ No| M[ğŸª Buscar en Mercado/Proveedores]

    L --> N[ğŸ§  Pricing Engine]
    N --> O[ğŸ’° Calcular Precio Sugerido]
    O --> P[ğŸ“ˆ Obtener Comparables]
    P --> Q[â±ï¸ Simulador de Ventas]
    Q --> R[ğŸ“Š Estimar Tiempo de Venta]

    %% GeneraciÃ³n de CotizaciÃ³n
    O --> S[ğŸ“„ Generar CotizaciÃ³n]
    R --> S
    M --> S

    S --> T[ğŸ’¾ Crear Registro CotizaciÃ³n]
    T --> U[(ğŸ—„ï¸ Base de Datos<br/>cotizaciones)]

    %% ComunicaciÃ³n con Cliente
    S --> V{ğŸ“¤ Â¿Canal original?}
    V -->|ğŸŒ Web| W[ğŸ“§ Enviar Email + PDF]
    V -->|ğŸ’¬ WhatsApp| X[ğŸ’¬ Enviar mensaje + PDF]
    V -->|ğŸ“ TelÃ©fono| Y[ğŸ“ Llamar y explicar]
    V -->|ğŸ¢ Presencial| Z[ğŸ“„ Entregar fÃ­sicamente]

    %% Seguimiento y NegociaciÃ³n
    W --> AA[ğŸ“¬ Cliente Recibe CotizaciÃ³n]
    X --> AA
    Y --> AA
    Z --> AA

    AA --> BB{ğŸ’­ Â¿Interesado?}
    BB -->|âœ… SÃ­| CC[ğŸ¤ NegociaciÃ³n]
    BB -->|âŒ No| DD[âŒ Fin - No interesado]

    CC --> EE{ğŸ’° Â¿Negociar precio?}
    EE -->|âœ… SÃ­| FF[ğŸ›ï¸ Simulador Interactivo]
    EE -->|âŒ No| GG[âœ… Proceder con precio original]

    FF --> HH[ğŸ‘† Cliente ajusta precio]
    HH --> II[ğŸ”„ Recalcular tiempo/mÃ¡rgen]
    II --> JJ[ğŸ“Š Mostrar impacto]
    JJ --> KK{ğŸ‘ Â¿Acepta nuevo precio?}
    KK -->|âœ… SÃ­| GG
    KK -->|âŒ No| LL[ğŸ”„ NegociaciÃ³n continÃºa]

    %% Reserva y Compra
    GG --> MM[ğŸ›’ Cliente decide comprar]
    MM --> NN{ğŸ“ Â¿Reserva o compra directa?}

    NN -->|â³ Reserva| OO[ğŸ“… Crear Reserva]
    OO --> PP[(ğŸ—„ï¸ Base de Datos<br/>reservas)]
    PP --> QQ[âœ… Enviar confirmaciÃ³n]
    QQ --> RR[ğŸ’³ Esperar pago inicial]

    NN -->|ğŸ›’ Compra Directa| SS[âœ… Proceder a venta]

    RR --> TT{ğŸ’³ Pago realizado?}
    TT -->|âœ… SÃ­| SS
    TT -->|âŒ No| UU[â° Recordatorio pago]

    %% Proceso de Venta
    SS --> VV[ğŸ’¼ Crear Registro Venta]
    VV --> WW[(ğŸ—„ï¸ Base de Datos<br/>ventas)]

    VV --> XX[ğŸ“‹ Generar DocumentaciÃ³n]
    XX --> YY[ğŸ§¾ Factura]
    YY --> ZZ[ğŸ“„ Contrato]
    ZZ --> AAA[ğŸ“‘ Documentos Legales]

    XX --> BBB[ğŸ”„ Actualizar Inventario]
    BBB --> CCC[âœ… Marcar auto como vendido]
    CCC --> DDD[(ğŸ—„ï¸ Base de Datos<br/>autos)]

    %% Entrega
    AAA --> EEE[ğŸš› Coordinar Entrega]
    EEE --> FFF{âš¡ Â¿Entrega inmediata?}
    FFF -->|âœ… SÃ­| GGG[ğŸš— Entregar vehÃ­culo]
    FFF -->|âŒ No| HHH[ğŸ“… Agendar fecha entrega]

    HHH --> III[ğŸ“† Fecha programada]
    III --> GGG

    GGG --> JJJ[ğŸ™Œ Cliente recibe auto]
    JJJ --> KKK[âœ… Actualizar estado venta]
    KKK --> LLL[ğŸ‰ Completado]

    %% Sistema de Seguimiento
    subgraph "ğŸ“Š Sistema de Seguimiento"
        MMM[ğŸ“ˆ Dashboard Admin]
        MMM --> NNN[ğŸ‘€ Ver todas cotizaciones]
        MMM --> OOO[â³ Ver reservas pendientes]
        MMM --> PPP[âœ… Ver ventas completadas]
        MMM --> QQQ[ğŸ“Š MÃ©tricas de conversiÃ³n]
    end

    %% Integraciones
    subgraph "ğŸ”— Integraciones Externas"
        RRR[ğŸ–¼ï¸ Cloudinary<br/>ImÃ¡genes]
        SSS[ğŸ’¬ WhatsApp API<br/>Mensajes]
        TTT[ğŸ“§ Email Service<br/>Notificaciones]
        UUU[ğŸ‘¥ CRM<br/>Historial cliente]
    end

    %% Conexiones del sistema
    U --> MMM
    PP --> MMM
    WW --> MMM
    DDD --> MMM

    XX --> RRR
    X --> SSS
    W --> TTT
    AA --> UUU

    %% Estilos para nodos
    classDef clienteClass fill:#3498db,color:#fff,stroke:#2980b9,stroke-width:2px
    classDef sistemaClass fill:#2ecc71,color:#fff,stroke:#27ae60,stroke-width:2px
    classDef decisionClass fill:#e74c3c,color:#fff,stroke:#c0392b,stroke-width:2px
    classDef procesoClass fill:#f39c12,color:#fff,stroke:#e67e22,stroke-width:2px
    classDef baseDatosClass fill:#9b59b6,color:#fff,stroke:#8e44ad,stroke-width:2px

    class A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,AA,BB,CC,DD,EE,FF,GG,HH,II,JJ,KK,LL,MM,NN,OO,PP,QQ,RR,SS,TT,UU,VV,WW,XX,YY,ZZ,AAA,BBB,CCC,DDD,EEE,FFF,GGG,HHH,III,JJJ,KKK,LLL clienteClass
    class MMM,NNN,OOO,PPP,QQQ sistemaClass
    class RRR,SSS,TTT,UUU integracionClass
            </div>
        </div>

        <div class="export-info">
            <h3>ğŸ–¼ï¸ Exportar Diagrama como Imagen</h3>
            <p><strong>OpciÃ³n 1 - Navegador:</strong> Click derecho en el diagrama â†’ "Guardar imagen como..."</p>
            <p><strong>OpciÃ³n 2 - Mermaid CLI:</strong> Instalar mermaid-cli y usar:</p>
            <pre><code>npm install -g @mermaid-js/mermaid-cli
mmdc -i diagrama.html -o diagrama.png</code></pre>
            <p><strong>OpciÃ³n 3 - Online:</strong> Copiar el cÃ³digo Mermaid a <a href="https://mermaid.live" target="_blank" rel="noopener">mermaid.live</a></p>
        </div>

        <div class="info-box">
            <h3>ğŸ“– Leyenda del Diagrama</h3>
            <ul>
                <li><strong>ğŸ‘¤ Cliente:</strong> Acciones realizadas por el cliente</li>
                <li><strong>ğŸ§  Sistema:</strong> Procesos automÃ¡ticos del sistema</li>
                <li><strong>ğŸ¤ NegociaciÃ³n:</strong> InteracciÃ³n cliente-sistema</li>
                <li><strong>ğŸ“Š Dashboard:</strong> Interfaz administrativa</li>
                <li><strong>ğŸ—„ï¸ Base de Datos:</strong> Almacenamiento persistente</li>
                <li><strong>ğŸ”— Integraciones:</strong> Servicios externos</li>
            </ul>
        </div>

        <div class="info-box">
            <h3>ğŸ¯ Puntos CrÃ­ticos del Proceso</h3>
            <ul>
                <li><strong>ğŸ“ Contacto inicial:</strong> Captura efectiva del lead</li>
                <li><strong>ğŸ” BÃºsqueda de auto:</strong> Disponibilidad en inventario</li>
                <li><strong>ğŸ§  Pricing inteligente:</strong> CÃ¡lculo automÃ¡tico de precios</li>
                <li><strong>ğŸ¤ NegociaciÃ³n:</strong> Simulador interactivo</li>
                <li><strong>ğŸ“‹ DocumentaciÃ³n:</strong> GeneraciÃ³n automÃ¡tica</li>
                <li><strong>ğŸš› Entrega:</strong> CoordinaciÃ³n logÃ­stica</li>
            </ul>
        </div>
    </div>

    <script>
        // Configurar Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            securityLevel: 'loose'
        });

        // Re-renderizar despuÃ©s de cargar
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.init();
        });
    </script>
</body>
</html>